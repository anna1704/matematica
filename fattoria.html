<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problemi Matematici: Fattoria degli Animali üêñ</title>
    <style>
        body {
            font-family: 'Verdana', sans-serif; /* Font Aggiornato */
            background-color: #f7e7c6; /* Giallo Paglierino (Tema Fattoria) */
            color: #3e2723; /* Marrone Scuro */
            text-align: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #d32f2f; /* Rosso Scuro */
            text-shadow: 2px 2px #ffeb3b;
            margin-bottom: 30px;
        }

        #problem-text {
            font-size: 1.3em;
            color: #3e2723; /* Testo del problema NERO */
            min-height: 100px;
            margin-bottom: 25px;
            padding: 15px;
            border: 2px dashed #4caf50;
            border-radius: 10px;
            background-color: #e8f5e9;
            text-align: left;
        }
        
        /* Stile per evidenziare la DOMANDA in ROSSO */
        .question {
            color: #b71c1c; /* Rosso Vivo */
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        /* Sezione Dati e Risposta */
        .input-group, .answer-section {
            text-align: left;
            margin-bottom: 20px;
        }
        .input-group label, .answer-section label {
            display: block;
            font-weight: bold;
            color: #00796b;
            margin-bottom: 5px;
        }

        textarea, .answer-section input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ff9800;
            border-radius: 8px;
            font-size: 1.1em;
            box-sizing: border-box;
            background-color: #fff3e0;
            resize: none;
            height: 80px;
            font-family: 'Verdana', sans-serif;
        }

        /* ---------------------------------------------------- */
        /* Stile per la Griglia di Calcolo in Colonna */
        /* ---------------------------------------------------- */
        .calculation-grid {
            background-color: #fffacd;
            border: 2px solid #ff6347;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 10px;
            text-align: center;
        }
        .calculation-grid h3 {
            color: #ff6347;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .grid-row {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .grid-cell {
            width: 50px;
            height: 35px;
            line-height: 35px;
            margin: 0 2px;
        }
        
        /* Cella per il simbolo dell'operazione (Ora nascosta con ?) e uguale */
        .symbol-cell {
            width: 30px;
            height: 35px;
            line-height: 35px;
            background-color: #ffe0b2;
            border: 1px solid #ffb74d;
            margin-left: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .equals-cell {
            background-color: #e0f7fa;
        }

        /* Input Riporto (pi√π piccolo e alto) */
        .carry-row .grid-cell input {
            width: 30px;
            height: 20px;
            font-size: 0.8em;
            color: #b71c1c;
            border: 1px dashed #b71c1c;
            background-color: #ffcccc;
            font-family: 'Verdana', sans-serif;
        }
        .carry-row {
            margin-bottom: 5px;
        }

        /* Input per i Numeri e Risultato */
        .number-row .grid-cell input, .result-row .grid-cell input {
            width: 48px;
            height: 33px;
            padding: 0;
            text-align: center;
            font-size: 1.1em;
            border: 1px solid #ccc;
            outline: none;
            box-sizing: border-box;
            background-color: white;
            font-family: 'Verdana', sans-serif;
        }
        
        .result-row {
            border-top: 2px solid #333;
            padding-top: 5px;
        }
        
        /* ---------------------------------------------------- */

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .controls button {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }

        #check-button {
            background-color: #4CAF50;
            color: white;
        }
        #check-button:hover:not(:disabled) { background-color: #45a049; transform: scale(1.05); }

        #next-button {
            background-color: #2196F3;
            color: white;
            display: none;
        }
        #next-button:hover:not(:disabled) { background-color: #1e88e5; transform: scale(1.05); }

        #status-message {
            margin-top: 20px;
            font-size: 1.4em;
            font-weight: bold;
            min-height: 30px;
        }
        .correct { color: #2e7d32; }
        .incorrect { color: #c62828; }
        
        #solution-display {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
            min-height: 24px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Problemi Matematici üêñ nella Fattoria üêì</h1>
        
        <div id="problem-text">Clicca su "Inizia l'Avventura" per caricare il primo problema!</div>

        <div class="input-group">
            <label for="data-input">Dati (Cosa conosci?)</label>
            <textarea id="data-input" rows="3" placeholder="Scrivi i numeri importanti e la domanda..."></textarea>
        </div>
        
        <div class="calculation-grid">
            <h3>Griglia di Calcolo in Colonna (Con Riporto/Prestito)</h3>
            
            <div class="grid-row carry-row">
                <div class="grid-cell"><input type="number" class="carry-input user-input" id="carry_c" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div> <div class="grid-cell"><input type="number" class="carry-input user-input" id="carry_d" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div> <div class="grid-cell"></div> <div style="width: 40px;"></div> </div>

            <div class="grid-row number-row">
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num1_c" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num1_d" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num1_u" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div style="width: 40px;"></div> </div>
            
            <div class="grid-row number-row">
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num2_c" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num2_d" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="num2_u" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="symbol-cell" id="operator-display">?</div> </div>
            
            <div class="grid-row result-row">
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="result_c" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="result_d" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="grid-cell"><input type="number" class="grid-input user-input" id="result_u" maxlength="1" oninput="this.value=this.value.slice(0,1)"></div>
                <div class="symbol-cell equals-cell">=</div>
            </div>
            
            <div id="solution-display"></div>
        </div>
        
        <div class="answer-section">
            <label for="answer-input">Risposta Finale (Solo il numero totale)</label>
            <input type="number" id="answer-input" placeholder="Il risultato totale del tuo calcolo">
        </div>

        <div class="controls">
            <button id="start-button" onclick="loadRandomProblem()">Inizia l'Avventura</button>
            <button id="check-button" onclick="checkAnswer()" disabled>Controlla Risposta Finale</button>
            <button id="next-button" onclick="loadRandomProblem()">Prossimo Problema ‚û°Ô∏è</button>
        </div>
        
        <div id="status-message"></div>
    </div>

    <script>
        // Array di 15 problemi aggiornato - rimosse le indicazioni di quali numeri usare
        const problems = [
            // ADDITION PROBLEMS
            {
                text: "Un contadino ha 134 galline e compra altre 58 galline. <span class='question'>Quante galline ha in totale? üêî</span>",
                answer: 192,
                operator: '+',
                solution: "134 + 58 = 192 galline. Addizione con riporto!",
            },
            {
                text: "C'erano 150 api in un alveare. Ne arrivano altre 75. <span class='question'>Quante api ci sono ora? üêù</span>",
                answer: 225,
                operator: '+',
                solution: "150 + 75 = 225 api. Addizione con riporto nelle decine!",
            },
            {
                text: "La stalla ha 211 mucche e 143 vitelli. <span class='question'>Quanti animali ci sono in totale nella stalla? üêÑ</span>",
                answer: 354,
                operator: '+',
                solution: "211 + 143 = 354 animali. Addizione senza riporto!",
            },
            {
                text: "Il signor Rossi ha 95 alberi di mele e 128 alberi di pere. <span class='question'>Quanti alberi ha in totale? üçé</span>",
                answer: 223,
                operator: '+',
                solution: "95 + 128 = 223 alberi. Addizione con riporto!",
            },
            {
                text: "Il pastore ha tosato 319 pecore luned√¨ e 180 pecore marted√¨. <span class='question'>Quante pecore ha tosato in due giorni? üêë</span>",
                answer: 499,
                operator: '+',
                solution: "319 + 180 = 499 pecore. Addizione semplice!",
            },

            // SUBTRACTION PROBLEMS
            {
                text: "Nel campo ci sono 245 meloni. Ne vengono raccolti 123 per il mercato. <span class='question'>Quanti meloni restano nel campo? üçâ</span>",
                answer: 122,
                operator: '-',
                solution: "245 - 123 = 122 meloni. Sottrazione semplice!",
            },
            {
                text: "Il pastore ha 93 pecore. Ne vende 47 a un altro allevatore. <span class='question'>Quante pecore gli restano? üêë</span>",
                answer: 46,
                operator: '-',
                solution: "93 - 47 = 46 pecore. Hai dovuto fare il prestito!",
            },
            {
                text: "La mamma prepara 110 biscotti. Se ne mangiano 25 durante la colazione. <span class='question'>Quanti biscotti sono rimasti? üç™</span>",
                answer: 85,
                operator: '-',
                solution: "110 - 25 = 85 biscotti. Hai dovuto gestire il prestito con lo zero!",
            },
            {
                text: "Il grande albero ospitava 450 uccelli. Ne volano via 162. <span class='question'>Quanti uccelli sono rimasti sull'albero? üê¶</span>",
                answer: 288,
                operator: '-',
                solution: "450 - 162 = 288 uccelli. Sottrazione con prestiti multipli!",
            },
            {
                text: "In una cassetta c'erano 399 uova. Se ne rompono 105. <span class='question'>Quante uova intere rimangono? ü•ö</span>",
                answer: 294,
                operator: '-',
                solution: "399 - 105 = 294 uova. Sottrazione semplice!",
            },

            // MULTIPLICATION PROBLEMS
            {
                text: "La volpe ruba 6 uova ogni giorno per 14 giorni. <span class='question'>Quante uova ha rubato in totale? ü¶ä</span>",
                answer: 84,
                operator: 'x',
                solution: "14 x 6 = 84 uova. Moltiplicazione a due cifre!",
            },
            {
                text: "Ci sono 4 scuderie, e in ogni scuderia ci sono 35 cavalli. <span class='question'>Quanti cavalli ci sono in tutto? üê¥</span>",
                answer: 140,
                operator: 'x',
                solution: "35 x 4 = 140 cavalli. Moltiplicazione con riporto!",
            },
            {
                text: "Il trattore ha percorso 112 metri. Quanti metri percorre se fa il giro 5 volte? <span class='question'>Quanti metri in totale? üöú</span>",
                answer: 560,
                operator: 'x',
                solution: "112 x 5 = 560 metri. Moltiplicazione a tre cifre!",
            },
            {
                text: "Ogni gallina mangia 7 chicchi di mais al giorno. Se ci sono 20 galline, <span class='question'>quanti chicchi mangiano in un giorno? üåΩ</span>",
                answer: 140,
                operator: 'x',
                solution: "20 x 7 = 140 chicchi. Moltiplicazione con lo zero!",
            },
            {
                text: "Il cane pastore porta a casa 6 nuovi cuccioli. Se ogni cucciolo beve 130 ml di latte, <span class='question'>quanti ml di latte bevono in totale? üêï</span>",
                answer: 780,
                operator: 'x',
                solution: "130 x 6 = 780 ml. Moltiplicazione con riporto a tre cifre!",
            },
        ];

        let currentProblem = null;
        const problemTextEl = document.getElementById('problem-text');
        const answerInputEl = document.getElementById('answer-input');
        const dataInputEl = document.getElementById('data-input');
        const checkButton = document.getElementById('check-button');
        const nextButton = document.getElementById('next-button');
        const startButton = document.getElementById('start-button');
        const statusMessageEl = document.getElementById('status-message');
        const solutionDisplayEl = document.getElementById('solution-display');
        const operatorDisplayEl = document.getElementById('operator-display');
        
        // Elementi input della griglia
        const userInputs = document.querySelectorAll('.user-input'); 

        /**
         * Resetta la griglia di calcolo e l'interfaccia.
         */
        function resetGrid() {
            userInputs.forEach(input => {
                input.value = '';
                input.disabled = false;
                input.style.backgroundColor = 'white';
            });
            operatorDisplayEl.textContent = '?';
        }

        /**
         * Sceglie un problema casuale e lo carica nella pagina.
         */
        function loadRandomProblem() {
            const randomIndex = Math.floor(Math.random() * problems.length);
            currentProblem = problems[randomIndex];

            // Resetta l'interfaccia e la griglia
            resetGrid();
            problemTextEl.innerHTML = currentProblem.text;
            answerInputEl.value = '';
            dataInputEl.value = '';
            statusMessageEl.innerHTML = '';
            solutionDisplayEl.innerHTML = '';

            // Abilita/Disabilita i pulsanti e gli input
            checkButton.disabled = false;
            answerInputEl.disabled = false;
            dataInputEl.disabled = false;
            nextButton.style.display = 'none';
            startButton.style.display = 'none';
        }

        /**
         * Controlla la risposta finale data dall'utente.
         */
        function checkAnswer() {
            if (!currentProblem) {
                statusMessageEl.innerHTML = 'Per favore, carica un problema prima!';
                return;
            }

            const userAnswer = parseInt(answerInputEl.value);
            const correctAnswer = currentProblem.answer;

            // 1. Verifica Risposta Finale
            if (isNaN(userAnswer)) {
                statusMessageEl.innerHTML = 'Devi inserire un numero valido nella risposta finale! üßê';
                statusMessageEl.className = 'incorrect';
                return;
            }

            // Disabilita tutti gli input
            answerInputEl.disabled = true;
            dataInputEl.disabled = true;
            checkButton.disabled = true;
            nextButton.style.display = 'inline-block';
            userInputs.forEach(input => input.disabled = true);

            // 2. Feedback
            let isCorrect = (userAnswer === correctAnswer);
            
            if (isCorrect) {
                statusMessageEl.innerHTML = 'üéâ RISPOSTA CORRETTA! Ottimo lavoro con il calcolo in colonna!';
                statusMessageEl.className = 'correct';
            } else {
                statusMessageEl.innerHTML = `‚ùå RISPOSTA SBAGLIATA. La risposta corretta era ${correctAnswer}.`;
                statusMessageEl.className = 'incorrect';
            }
            
            // 3. Popolamento Griglia Risultato e rivelazione operatore
            operatorDisplayEl.textContent = currentProblem.operator;

            const finalResultC = correctAnswer >= 100 ? Math.floor(correctAnswer / 100) : '';
            const finalResultD = correctAnswer >= 10 ? Math.floor((correctAnswer % 100) / 10) : '';
            const finalResultU = correctAnswer % 10;
            
            document.getElementById('result_c').value = finalResultC;
            document.getElementById('result_d').value = finalResultD;
            document.getElementById('result_u').value = finalResultU;

            const color = isCorrect ? '#ccffcc' : '#ffcccc';
            document.getElementById('result_c').style.backgroundColor = color;
            document.getElementById('result_d').style.backgroundColor = color;
            document.getElementById('result_u').style.backgroundColor = color;

            solutionDisplayEl.innerHTML = `Spiegazione: <strong>${currentProblem.solution}</strong>`;
        }
    </script>

</body>
</html>
